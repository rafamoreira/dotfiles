###############################################################################
#                        prefix                                               #
###############################################################################

unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix


###############################################################################
#                        options                                              #
###############################################################################

# window index starts at 1 (closer to the keyboard)
set -g base-index 1

# TERM must be 'screen', 'tmux' or a derivative for tmux to work correctly
set-option -g default-terminal "tmux-256color"

# no delay for escape key press (critical for neovim)
set-option -sg escape-time 0

# pass focus events through to applications (neovim autoread etc.)
set-option -g focus-events on

# true color support for Ghostty
set-option -ga terminal-overrides ",*:RGB"

# set terminal window title to reflect current tmux session/window
set-option -g set-titles on

# automatically rename window to current running command
set-window-option -g automatic-rename on

# command prompt uses emacs keys (default, fine to keep)
set -g status-keys emacs

# vi keys in copy mode
set -g mode-keys vi

# large scrollback
set -g history-limit 500000

# mouse support
set -g mouse on

# highlight windows with activity in the status bar
set -g monitor-activity on

# keep history file
set-option -g history-file ~/.config/tmux/history


###############################################################################
#                        keybindings                                          #
###############################################################################

# reload config
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded"

# open splits and new windows in the current path
unbind-key v
bind-key v split-window -h -c "#{pane_current_path}"
unbind-key s
bind-key s split-window -v -c "#{pane_current_path}"
bind-key c new-window -c "#{pane_current_path}"


###############################################################################
#                        pane navigation                                      #
###############################################################################

# alt+hjkl to switch panes (no prefix needed)
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# alt+arrows as aliases
bind -n M-Left  select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up    select-pane -U
bind -n M-Down  select-pane -D

# prefix+HJKL to resize panes (5 cells at a time)
bind-key H resize-pane -L 5
bind-key J resize-pane -D 5
bind-key K resize-pane -U 5
bind-key L resize-pane -R 5

# shift+arrows to switch windows (no prefix needed)
bind -n S-Left  previous-window
bind -n S-Right next-window


###############################################################################
#                        copy mode                                            #
###############################################################################

# v to begin selection, C-v for rectangle, y to yank (vim-like)
bind-key -T copy-mode-vi 'v'   send -X begin-selection
bind-key -T copy-mode-vi 'C-v' send -X rectangle-toggle
bind-key -T copy-mode-vi 'y'   send -X copy-selection

# copy to macOS clipboard on enter or mouse drag
unbind -T copy-mode-vi Enter
bind-key -T copy-mode-vi Enter        send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# ctrl+scroll to page through history
bind -n C-WheelUpPane   select-pane -t= \; copy-mode -e \; send-keys -M
bind -T copy-mode-vi    C-WheelUpPane   send-keys -X halfpage-up
bind -T copy-mode-vi    C-WheelDownPane send-keys -X halfpage-down


###############################################################################
#                        theme                                                #
###############################################################################

set -g @catppuccin_flavor "mocha"
set -g @catppuccin_window_status_style "rounded"
run-shell "~/.config/tmux/plugins/catppuccin/catppuccin.tmux"
